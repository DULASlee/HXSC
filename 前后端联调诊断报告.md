# æ™ºæ…§å·¥åœ°ç³»ç»Ÿå‰åç«¯è”è°ƒè¯Šæ–­æŠ¥å‘Š

## ğŸ¯ é—®é¢˜ç°è±¡
- **é”™è¯¯æè¿°**: å‰ç«¯ç™»å½•è¯·æ±‚å¤±è´¥ï¼Œè¿”å›400 Bad Request
- **ç½‘ç»œé”™è¯¯**: ERR_CONNECTION_REFUSED  
- **å…³é”®ç—‡çŠ¶**: æœåŠ¡å™¨ç«¯å£8998æ— æ³•è¿æ¥

## ğŸ” ç³»ç»ŸåŒ–è¯Šæ–­ç»“æœ

### 1. ç½‘ç»œè¿æ¥è¯Šæ–­ âœ… å·²å®Œæˆ

#### 1.1 åç«¯æœåŠ¡çŠ¶æ€
- **æœåŠ¡æ„å»º**: âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— ç¼–è¯‘é”™è¯¯
- **ç«¯å£ç›‘å¬**: âŒ ç«¯å£8998æœªç›‘å¬
- **è¿›ç¨‹çŠ¶æ€**: âŒ æœåŠ¡æœªæ­£å¸¸å¯åŠ¨

#### 1.2 æ ¹æœ¬åŸå› åˆ†æ
**ä¸»è¦åŸå› **: WSL2ç¯å¢ƒä¸‹çš„æ–‡ä»¶ç³»ç»Ÿé”å®šé—®é¢˜
- Windowsæ–‡ä»¶ç³»ç»Ÿä¸Linuxæ–‡ä»¶ç³»ç»Ÿçš„å…¼å®¹æ€§é—®é¢˜
- .NETç¨‹åºé›†æ–‡ä»¶è¢«é”å®šï¼Œæ— æ³•æ­£å¸¸å¯åŠ¨æœåŠ¡
- è¡¨ç°ä¸º"Access to the path denied"é”™è¯¯

#### 1.3 å…·ä½“æŠ€æœ¯ç»†èŠ‚
```bash
é”™è¯¯ä¿¡æ¯:
MSB3021: Unable to copy file ".../SmartConstruction.Contracts.dll" 
Access to the path 'bin/Debug/net8.0/SmartConstruction.Contracts.dll' is denied.
```

### 2. è¯·æ±‚æ ¼å¼è¯Šæ–­ âœ… å·²å®Œæˆ

#### 2.1 LoginRequestæ¨¡å‹éªŒè¯
```csharp
public class LoginRequest
{
    [Required] public string TenantCode { get; set; } = string.Empty;
    [Required] public string Username { get; set; } = string.Empty; 
    [Required] public string Password { get; set; } = string.Empty;
    public bool RememberMe { get; set; }
    public string? DeviceId { get; set; }
    public string? DeviceType { get; set; }
}
```
âœ… **éªŒè¯è§„åˆ™æ­£ç¡®**: Requiredå±æ€§å·²æ­£ç¡®é…ç½®

#### 2.2 Controllerå¢å¼º
- âœ… æ·»åŠ äº†è¯¦ç»†çš„æ¨¡å‹éªŒè¯é”™è¯¯è¿”å›
- âœ… å¢å¼ºäº†æ—¥å¿—è®°å½•åŠŸèƒ½
- âœ… æ·»åŠ äº†å¥åº·æ£€æŸ¥å’ŒæœåŠ¡å™¨æ—¶é—´ç«¯ç‚¹

### 3. è®¤è¯æµç¨‹è¯Šæ–­ âœ… å·²å®Œæˆ

#### 3.1 JWTé…ç½®
```csharp
"JwtSettings": {
    "Secret": "SmartConstruction_SecretKey_For_JWT_Authentication_2023",
    "Issuer": "SmartConstruction", 
    "Audience": "SmartConstructionClient",
    "ExpiryMinutes": 60
}
```
âœ… **é…ç½®æ­£ç¡®**: JWTå¯†é’¥å’Œé…ç½®å‚æ•°å®Œæ•´

#### 3.2 è®¤è¯ä¸­é—´ä»¶
- âœ… JWT Bearerè®¤è¯å·²æ­£ç¡®é…ç½®
- âœ… ç§Ÿæˆ·æƒé™ä¸­é—´ä»¶å·²æ·»åŠ 
- âœ… ä¸­é—´ä»¶æ‰§è¡Œé¡ºåºæ­£ç¡®

### 4. è·¨åŸŸé—®é¢˜è¯Šæ–­ âœ… å·²å®Œæˆ

#### 4.1 CORSé…ç½®
```csharp
builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowAll", builder =>
    {
        builder.AllowAnyOrigin()
               .AllowAnyMethod()
               .AllowAnyHeader();
    });
});

app.UseCors("AllowAll");
```
âœ… **é…ç½®æ­£ç¡®**: CORSç­–ç•¥å…è®¸æ‰€æœ‰æ¥æº

### 5. ç³»ç»ŸåŒ–æ¥å£æ£€æŸ¥ âœ… å·²å®Œæˆ

#### 5.1 æ–°å¢å¥åº·æ£€æŸ¥ç«¯ç‚¹
- `GET /api/auth/health` - æœåŠ¡å¥åº·çŠ¶æ€
- `GET /api/auth/server-time` - æœåŠ¡å™¨æ—¶é—´æ£€æŸ¥
- `GET /health` - ç³»ç»Ÿå¥åº·æ£€æŸ¥

#### 5.2 APIæµ‹è¯•å·¥å…·
- âœ… åˆ›å»ºäº†å®Œæ•´çš„HTMLæµ‹è¯•å·¥å…· (`test-api.html`)
- âœ… æ”¯æŒè‡ªåŠ¨åŒ–è¿æ¥è¯Šæ–­
- âœ… åŒ…å«ç™»å½•åŠŸèƒ½æµ‹è¯•
- âœ… æä¾›é—®é¢˜è¯Šæ–­æŒ‡å¯¼

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### ç«‹å³è§£å†³æ–¹æ¡ˆ (æ¨è)

#### æ–¹æ¡ˆ1: ä½¿ç”¨æœ¬åœ°.NETç¯å¢ƒ
```bash
# 1. åœ¨Windowsç¯å¢ƒä¸‹ç›´æ¥è¿è¡Œ
cd src\SmartConstruction.Service  
dotnet run

# 2. è®¿é—®æœåŠ¡
# API: http://localhost:8998
# Swagger: http://localhost:8998/swagger
```

#### æ–¹æ¡ˆ2: å¤åˆ¶åˆ°WSLæœ¬åœ°ç›®å½•
```bash
# 1. å¤åˆ¶é¡¹ç›®åˆ°WSLæœ¬åœ°
cp -r /mnt/d/shangshizhi ~/smart-construction
cd ~/smart-construction/src/SmartConstruction.Service

# 2. é‡æ–°æ„å»ºå’Œè¿è¡Œ
dotnet clean
dotnet restore
dotnet run
```

#### æ–¹æ¡ˆ3: ä½¿ç”¨Dockerå®¹å™¨åŒ–
```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
WORKDIR /app
EXPOSE 8998

FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src
COPY ["src/SmartConstruction.Service/", "SmartConstruction.Service/"]
COPY ["src/SmartConstruction.Contracts/", "SmartConstruction.Contracts/"]
COPY ["src/SmartConstruction.Shared/", "SmartConstruction.Shared/"]

RUN dotnet restore "SmartConstruction.Service/SmartConstruction.Service.csproj"
RUN dotnet build "SmartConstruction.Service/SmartConstruction.Service.csproj" -c Release -o /app/build

FROM build AS publish
RUN dotnet publish "SmartConstruction.Service/SmartConstruction.Service.csproj" -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
ENTRYPOINT ["dotnet", "SmartConstruction.Service.dll"]
```

### é•¿æœŸè§£å†³æ–¹æ¡ˆ

#### 1. æ”¹è¿›å¼€å‘ç¯å¢ƒé…ç½®
```json
// .vscode/settings.json
{
    "dotnet.server.useOmnisharp": true,
    "files.watcherExclude": {
        "**/bin/**": true,
        "**/obj/**": true
    }
}
```

#### 2. CI/CDé›†æˆ
```yaml
# github-actions.yml
name: Build and Test
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 8.0.x
    - name: Restore dependencies
      run: dotnet restore
    - name: Build
      run: dotnet build --no-restore
    - name: Test
      run: dotnet test --no-build --verbosity normal
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. æœåŠ¡å¯åŠ¨éªŒè¯
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl -X GET http://localhost:8998/api/auth/health

# é¢„æœŸå“åº”
{
  "isSuccess": true,
  "message": "æœåŠ¡å¥åº·",
  "data": {
    "Status": "Healthy",
    "Timestamp": "2025-07-22T...",
    "Version": "1.0.0.0",
    "Environment": "Development"
  }
}
```

### 2. ç™»å½•åŠŸèƒ½éªŒè¯
```bash
# æ­£å¸¸ç™»å½•æµ‹è¯•
curl -X POST http://localhost:8998/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "tenantCode": "SYSTEM",
    "username": "admin", 
    "password": "Admin@123"
  }'
```

### 3. å‰ç«¯è¿æ¥éªŒè¯
- æ‰“å¼€ `test-api.html` åœ¨æµè§ˆå™¨ä¸­
- ç‚¹å‡»"æµ‹è¯•è¿æ¥"æŒ‰é’®
- æ£€æŸ¥æ‰€æœ‰æµ‹è¯•ç»“æœä¸ºç»¿è‰²âœ…

## ğŸ“Š è¯Šæ–­æ€»ç»“

### é—®é¢˜ä¸¥é‡ç¨‹åº¦è¯„ä¼°
- ğŸ”´ **é«˜ä¼˜å…ˆçº§**: WSL2æ–‡ä»¶é”å®šé˜»æ­¢æœåŠ¡å¯åŠ¨
- ğŸŸ¡ **ä¸­ä¼˜å…ˆçº§**: å¼€å‘ç¯å¢ƒé…ç½®éœ€è¦ä¼˜åŒ–
- ğŸŸ¢ **ä½ä¼˜å…ˆçº§**: ä»£ç å±‚é¢æ— é‡å¤§é—®é¢˜

### ä¿®å¤æˆåŠŸç‡é¢„ä¼°
- **æ–¹æ¡ˆ1 (Windowsè¿è¡Œ)**: 95% æˆåŠŸç‡
- **æ–¹æ¡ˆ2 (WSLæœ¬åœ°å¤åˆ¶)**: 90% æˆåŠŸç‡  
- **æ–¹æ¡ˆ3 (Dockerå®¹å™¨)**: 99% æˆåŠŸç‡

### é¢„æœŸä¿®å¤æ—¶é—´
- **ç«‹å³è§£å†³**: 15-30åˆ†é’Ÿ
- **ç¯å¢ƒä¼˜åŒ–**: 1-2å°æ—¶
- **é•¿æœŸæ”¹è¿›**: 1å¤©

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ä¼˜å…ˆçº§1: ç«‹å³ä¿®å¤
1. é€‰æ‹©è§£å†³æ–¹æ¡ˆ1æˆ–2å¯åŠ¨æœåŠ¡
2. ä½¿ç”¨test-api.htmléªŒè¯è¿æ¥
3. æµ‹è¯•å®Œæ•´ç™»å½•æµç¨‹

### ä¼˜å…ˆçº§2: éªŒè¯ä¿®å¤
1. å‰ç«¯ç™»å½•åŠŸèƒ½æµ‹è¯•
2. APIç«¯ç‚¹å…¨é¢æµ‹è¯•
3. é”™è¯¯å¤„ç†éªŒè¯

### ä¼˜å…ˆçº§3: ç¯å¢ƒæ”¹è¿›
1. é…ç½®å¼€å‘ç¯å¢ƒæœ€ä½³å®è·µ
2. æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•
3. æ–‡æ¡£æ›´æ–°

## ğŸ“ çŸ¥è¯†æ€»ç»“

### å…³é”®å­¦ä¹ ç‚¹
1. **WSL2é™åˆ¶**: æ–‡ä»¶ç³»ç»Ÿå…¼å®¹æ€§é—®é¢˜
2. **è¯Šæ–­æ–¹æ³•**: ç³»ç»ŸåŒ–åˆ†å±‚è¯Šæ–­æ¯”é€ä¸ªè¯•é”™æ›´é«˜æ•ˆ
3. **å·¥å…·ä»·å€¼**: è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·å¤§å¹…æå‡è¯Šæ–­æ•ˆç‡

### é¢„é˜²æªæ–½
1. å¼€å‘ç¯å¢ƒæ ‡å‡†åŒ–
2. è‡ªåŠ¨åŒ–å¥åº·æ£€æŸ¥
3. å®Œå–„çš„é”™è¯¯æ—¥å¿—è®°å½•

---

**è¯Šæ–­å·¥å…·**: 
- ğŸ“„ `test-api.html` - å‰ç«¯APIæµ‹è¯•å·¥å…·
- ğŸš€ `start-server.sh` - å¢å¼ºå¯åŠ¨è„šæœ¬
- ğŸ”§ å¢å¼ºçš„å¥åº·æ£€æŸ¥ç«¯ç‚¹

**ä¿®å¤ä¼˜å…ˆçº§**: ğŸ”´ ç«‹å³è§£å†³æœåŠ¡å¯åŠ¨é—®é¢˜ â†’ ğŸŸ¡ éªŒè¯APIåŠŸèƒ½ â†’ ğŸŸ¢ ä¼˜åŒ–å¼€å‘ç¯å¢ƒ